# 테이블 구조 변경 방법

### 1. src/main/resources/db/migration 디렉토리에 새로운 마이그레이션 파일 생성

- 이전 버전까지 적용되어있는 테이블 구조에서 변경사항만 SQL로 작성
- 마이그레이션 파일명은 V{버전}_{마이그레이션_내용}.sql 형식으로 생성
    - 예) V1__createTable.sql
- 버전은 기존에 존재하는 마이그레이션 파일의 버전보다 큰 숫자로 생성
    - 다른 pr이 먼저 merge 되고, 마이그레이션 파일이 추가된 경우, 내가 merge 시킬 마이그레이션 파일 버전이 가장 큰 숫자인지 반드시 확인

### 2. FlywayMigrationTest.java 테스트를 실행하여 마이그레이션 적용 확인

- 최상위 테스트가 성공하면 마이그레이션 파일이 정상적으로 적용된 것
- 추가한 SQL 파일에 대한 개별 테스트를 진행하고 싶으면, FileReader 및 CCJSqlParserUtil를 활용한 테스트 진행
    - 예시 테스트가 클래스 내에 존재하므로 참고바람!

### 3. 마이그레이션 파일을 PR에 포함하여 merge

- 깃허브 워크플로우를 통해 마이그레이션 정상 적용 여부 확인 가능
- 정상 적용 실패 시 액션 failed

# 로컬 데이터베이스에 마이그레이션 적용 방법

1. 로컬 데이터베이스를 초기화한 후, application-local.yml 파일에 flyway.enabled 설정을 true로 변경
2. Global 패키지에 위치한 FlywayConfig 클래스 주석 제거 및 스프링 실행